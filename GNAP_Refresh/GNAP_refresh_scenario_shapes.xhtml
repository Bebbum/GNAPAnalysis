<?xml version="1.0"?>
<!-- CPSA 3.6.9 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Grant Negotiation and Authorization Protocol</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(comment &quot;CPSA 3.6.9&quot;)
(comment &quot;Extracted shapes&quot;)
(herald &quot;Grant Negotiation and Authorization Protocol&quot; (limit 10000)
  (comment
    &quot;This protocol allows a piece of software, the client instance, to request delegated authorization to resource servers and to request direct information&quot;))
(comment &quot;CPSA 3.6.9&quot;)
(comment &quot;All input read from GNAP_refresh_scenario.scm&quot;)
(comment &quot;Step count limited to 10000&quot;)</pre>

<p id="top">Trees: <a href="#t0">0</a> <a href="#t40">40</a> <a href="#t78">78</a>.</p>

<p id="t0">Tree <a href="#top">0</a>, POV <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k33&quot;, &quot;_self&quot;)'>33</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol token_refresh basic
  (defrole client
    (vars (c as rs name)
      (access management_uri management_uri_new response data)
      (n1 n2 n3 n4 text) (token token_new mesg))
    (trace (send (enc c n1 (pubk as))) (recv (enc as n1 n2 (pubk c)))
      (send (enc n2 (pubk as))) (send (enc c access (hash n1 n2)))
      (recv (enc management_uri token (hash n1 n2)))
      (send (enc c n3 (pubk rs))) (recv (enc rs n3 n4 (pubk c)))
      (send (enc n4 (pubk rs))) (send (enc token (hash n3 n4)))
      (recv (enc response (hash n3 n4))) (send (enc token (hash n3 n4)))
      (recv (enc response (hash n3 n4))) (send (enc token (hash n1 n2)))
      (recv (enc management_uri_new token_new (hash n1 n2)))
      (send (enc token_new (hash n3 n4)))
      (recv (enc response (hash n3 n4))))
    (uniq-orig n1 n3))
  (defrole authorization_server
    (vars (c as rs name)
      (access access_token access_token_new access_type management_uri
        management_uri_new value data) (n1 n2 text))
    (trace (recv (enc c n1 (pubk as))) (send (enc as n1 n2 (pubk c)))
      (recv (enc n2 (pubk as))) (recv (enc c access (hash n1 n2)))
      (send
        (enc management_uri
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n1 n2)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n1 n2)))
      (send
        (enc management_uri_new
          (enc (enc access_token_new value access_type (privk as))
            (pubk rs)) (hash n1 n2))))
    (uniq-orig n2))
  (defrole resource_server
    (vars (c as rs name)
      (access_token access_token_new value access_type response data)
      (n3 n4 text))
    (trace (recv (enc c n3 (pubk rs))) (send (enc rs n3 n4 (pubk c)))
      (recv (enc n4 (pubk rs)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n3 n4))) (send (enc response (hash n3 n4)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n3 n4))) (send (enc response (hash n3 n4)))
      (recv
        (enc
          (enc (enc access_token_new value access_type (privk as))
            (pubk rs)) (hash n3 n4)))
      (send (enc response (hash n3 n4))))
    (uniq-orig n4)))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k33">33</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='1279.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 1279.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='1239.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: red;' cx='39.960' cy='1239.960' r='6.000'/></g>
  <g><title>(enc token_new (hash n3 n4))</title>
   <circle cx='39.960' cy='1164.960' r='6.000'/></g>
  <g><title>(enc management_uri_new token_new (hash n1 n2))</title>
   <circle style='fill: red;' cx='39.960' cy='1089.960' r='6.000'/></g>
  <g><title>(enc token (hash n1 n2))</title>
   <circle cx='39.960' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: red;' cx='39.960' cy='939.960' r='6.000'/></g>
  <g><title>(enc token (hash n3 n4))</title>
   <circle cx='39.960' cy='864.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: red;' cx='39.960' cy='789.960' r='6.000'/></g>
  <g><title>(enc token (hash n3 n4))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(enc rs n3 n4 (pubk c))</title>
   <circle style='fill: red;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>(enc management_uri token (hash n1 n2))</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((token token) (token_new token_new) (n1 n1) (n2 n2) (n3 n3) (n4 n4) (access access) (management_uri management_uri) (management_uri_new management_uri_new) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>client</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>token_refresh 0</text></svg></div>

<pre>(defskeleton token_refresh
  (vars (token token_new mesg) (n1 n2 n3 n4 text)
    (management_uri management_uri_new access response data)
    (c as rs name))
  (defstrand client 16 (token token) (token_new token_new) (n1 n1)
    (n2 n2) (n3 n3) (n4 n4) (access access)
    (management_uri management_uri)
    (management_uri_new management_uri_new) (response response) (c c)
    (as as) (rs rs))
  (neq (c as) (c rs) (as rs) (management_uri management_uri_new)
    (token token_new))
  (non-orig (privk c) (privk as) (privk rs))
  (uniq-orig n1 n3)
  (label 0)
  (unrealized (0 1) (0 4) (0 6) (0 9) (0 11) (0 13) (0 15))
  (origs (n1 (0 0)) (n3 (0 5)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k33">Item <a href="#t0">33</a>, Parent: <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='1279.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 1279.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='1089.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='489.960' x2='139.920' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='1239.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 1089.960 Q 142.920 1052.460 45.960 1089.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri_new (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle cx='239.880' cy='1089.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='1014.960' r='6.000'/>
   </g>
  <path
   d='M 239.880 414.960 Q 142.920 377.460 45.960 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk as))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 239.880 189.960 Q 142.920 152.460 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc as n1 n4 (pubk c))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 789.960 Q 92.940 789.960 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4-0))</title>
   <circle cx='139.920' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4-0))</title>
   <circle style='fill: blue;' cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>(enc n4-0 (pubk rs))</title>
   <circle style='fill: blue;' cx='139.920' cy='639.960' r='6.000'/></g>
  <path
   d='M 139.920 564.960 Q 92.940 564.960 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc rs n3 n4-0 (pubk c))</title>
   <circle cx='139.920' cy='564.960' r='6.000'/></g>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='1239.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n3 n4-0))</title>
   <circle cx='39.960' cy='1164.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1089.960' r='6.000'/></g>
  <path
   d='M 39.960 1014.960 Q 136.920 977.460 233.880 1014.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle cx='39.960' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4-0))</title>
   <circle cx='39.960' cy='864.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 86.940 714.960 133.920 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4-0))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <path
   d='M 39.960 639.960 Q 86.940 639.960 133.920 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4-0 (pubk rs))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(enc rs n3 n4-0 (pubk c))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <path
   d='M 39.960 489.960 Q 86.940 489.960 133.920 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 136.920 302.460 233.880 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c access (hash n1 n4))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <path
   d='M 39.960 264.960 Q 136.920 227.460 233.880 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4 (pubk as))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n4 (pubk c))</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 136.920 77.460 233.880 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c n1 (pubk as))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((n1 n1) (n2 n4) (access access) (access_token access_token) (access_token_new access_token_new) (access_type access_type) (management_uri management_uri) (management_uri_new management_uri_new) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((n3 n3) (n4 n4-0) (access_token access_token) (value value) (access_type access_type) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs))) (token_new (enc (enc access_token_new value access_type (privk as)) (pubk rs))) (n1 n1) (n2 n4) (n3 n3) (n4 n4-0) (access access) (management_uri management_uri) (management_uri_new management_uri_new) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>client</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>token_refresh 33 (realized)</text></svg>
 </div>

<pre>(defskeleton token_refresh
  (vars (n1 n3 n4 n4-0 text)
    (management_uri_new response access access_token access_token_new
      access_type management_uri value data) (c as rs name))
  (defstrand client 16
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs)))
    (token_new
      (enc (enc access_token_new value access_type (privk as))
        (pubk rs))) (n1 n1) (n2 n4) (n3 n3) (n4 n4-0) (access access)
    (management_uri management_uri)
    (management_uri_new management_uri_new) (response response) (c c)
    (as as) (rs rs))
  (defstrand resource_server 5 (n3 n3) (n4 n4-0)
    (access_token access_token) (value value) (access_type access_type)
    (response response) (c c) (as as) (rs rs))
  (defstrand authorization_server 7 (n1 n1) (n2 n4) (access access)
    (access_token access_token) (access_token_new access_token_new)
    (access_type access_type) (management_uri management_uri)
    (management_uri_new management_uri_new) (value value) (c c) (as as)
    (rs rs))
  (precedes ((0 0) (2 0)) ((0 2) (2 2)) ((0 3) (2 3)) ((0 5) (1 0))
    ((0 7) (1 2)) ((0 8) (1 3)) ((0 12) (2 5)) ((1 1) (0 6))
    ((1 4) (0 9)) ((2 1) (0 1)) ((2 4) (0 4)) ((2 6) (0 13)))
  (neq (c as) (c rs) (as rs) (management_uri management_uri_new)
    ((enc (enc access_token value access_type (privk as)) (pubk rs))
      (enc (enc access_token_new value access_type (privk as))
        (pubk rs))))
  (non-orig (privk c) (privk as) (privk rs))
  (uniq-orig n1 n3 n4 n4-0)
  (operation encryption-test (displaced 3 0 client 13)
    (enc (enc (enc access_token value access_type (privk as)) (pubk rs))
      (hash n1 n4)) (2 5))
  (label 33)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c) (as as) (rs rs) (management_uri management_uri)
        (management_uri_new management_uri_new)
        (token
          (enc (enc access_token value access_type (privk as))
            (pubk rs)))
        (token_new
          (enc (enc access_token_new value access_type (privk as))
            (pubk rs))) (access access) (response response) (n1 n1)
        (n2 n4) (n3 n3) (n4 n4-0))))
  (origs (n1 (0 0)) (n3 (0 5)) (n4 (2 1)) (n4-0 (1 1))))</pre>

<p id="t40">Tree <a href="#top">40</a>, POV <a href="#k40">40</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k64&quot;, &quot;_self&quot;)'>64</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k40&quot;, &quot;_self&quot;)'>40</text>
  </svg></div>

<pre>(defprotocol token_refresh basic
  (defrole client
    (vars (c as rs name)
      (access management_uri management_uri_new response data)
      (n1 n2 n3 n4 text) (token token_new mesg))
    (trace (send (enc c n1 (pubk as))) (recv (enc as n1 n2 (pubk c)))
      (send (enc n2 (pubk as))) (send (enc c access (hash n1 n2)))
      (recv (enc management_uri token (hash n1 n2)))
      (send (enc c n3 (pubk rs))) (recv (enc rs n3 n4 (pubk c)))
      (send (enc n4 (pubk rs))) (send (enc token (hash n3 n4)))
      (recv (enc response (hash n3 n4))) (send (enc token (hash n3 n4)))
      (recv (enc response (hash n3 n4))) (send (enc token (hash n1 n2)))
      (recv (enc management_uri_new token_new (hash n1 n2)))
      (send (enc token_new (hash n3 n4)))
      (recv (enc response (hash n3 n4))))
    (uniq-orig n1 n3))
  (defrole authorization_server
    (vars (c as rs name)
      (access access_token access_token_new access_type management_uri
        management_uri_new value data) (n1 n2 text))
    (trace (recv (enc c n1 (pubk as))) (send (enc as n1 n2 (pubk c)))
      (recv (enc n2 (pubk as))) (recv (enc c access (hash n1 n2)))
      (send
        (enc management_uri
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n1 n2)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n1 n2)))
      (send
        (enc management_uri_new
          (enc (enc access_token_new value access_type (privk as))
            (pubk rs)) (hash n1 n2))))
    (uniq-orig n2))
  (defrole resource_server
    (vars (c as rs name)
      (access_token access_token_new value access_type response data)
      (n3 n4 text))
    (trace (recv (enc c n3 (pubk rs))) (send (enc rs n3 n4 (pubk c)))
      (recv (enc n4 (pubk rs)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n3 n4))) (send (enc response (hash n3 n4)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n3 n4))) (send (enc response (hash n3 n4)))
      (recv
        (enc
          (enc (enc access_token_new value access_type (privk as))
            (pubk rs)) (hash n3 n4)))
      (send (enc response (hash n3 n4))))
    (uniq-orig n4)))</pre>

<p id="k40">Item <a href="#t40">40</a>, Child: <a href="#k64">64</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='604.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 604.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g>
   <title>(enc management_uri_new (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: red;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((n1 n1) (n2 n2) (access access) (access_token access_token) (access_token_new access_token_new) (access_type access_type) (management_uri management_uri) (management_uri_new management_uri_new) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>token_refresh 40</text></svg></div>

<pre>(defskeleton token_refresh
  (vars (n1 n2 text)
    (management_uri management_uri_new access_token access_token_new
      access access_type value data) (c as rs name))
  (defstrand authorization_server 7 (n1 n1) (n2 n2) (access access)
    (access_token access_token) (access_token_new access_token_new)
    (access_type access_type) (management_uri management_uri)
    (management_uri_new management_uri_new) (value value) (c c) (as as)
    (rs rs))
  (neq (c as) (c rs) (as rs) (management_uri management_uri_new)
    (access_token access_token_new))
  (non-orig (privk c) (privk as) (privk rs))
  (uniq-orig n2)
  (label 40)
  (unrealized (0 2) (0 3) (0 5))
  (origs (n2 (0 1)))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k64">Item <a href="#t40">64</a>, Parent: <a href="#k40">40</a>.</p>

<div>
 <svg
  class='diagram' width='179.880pt' height='1129.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 179.880 1129.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='1014.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='1089.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 139.920 1014.960 Q 92.940 1014.960 45.960 1014.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='139.920' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle cx='139.920' cy='864.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='139.920' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle cx='139.920' cy='714.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(enc rs-0 n3 n4 (pubk c))</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <g><title>(enc c n3 (pubk rs-0))</title>
   <circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <path
   d='M 139.920 339.960 Q 92.940 339.960 45.960 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <path
   d='M 139.920 264.960 Q 92.940 264.960 45.960 264.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n2 (pubk as))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <path
   d='M 139.920 114.960 Q 92.940 114.960 45.960 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c n1 (pubk as))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='39.960' cy='1089.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: blue;' cx='39.960' cy='1014.960' r='6.000'/></g>
  <path
   d='M 39.960 414.960 Q 86.940 414.960 133.920 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle style='fill: blue;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle style='fill: blue;' cx='39.960' cy='264.960' r='6.000'/></g>
  <path
   d='M 39.960 189.960 Q 86.940 189.960 133.920 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs))) (n1 n1) (n2 n2) (n3 n3) (n4 n4) (access access) (management_uri management_uri) (response response) (c c) (as as) (rs rs-0))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>client</text>
   </g>
  <g>
   <title>((n1 n1) (n2 n2) (access access) (access_token access_token) (access_token_new access_token_new) (access_type access_type) (management_uri management_uri) (management_uri_new management_uri_new) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <text
   x='89.940' y='39.960'
   style='text-anchor: middle;'>token_refresh 64 (realized)</text></svg>
 </div>

<pre>(defskeleton token_refresh
  (vars (n1 n2 n3 n4 text)
    (management_uri management_uri_new access_token access_token_new
      access_type value access response data) (rs c as rs-0 name))
  (defstrand authorization_server 7 (n1 n1) (n2 n2) (access access)
    (access_token access_token) (access_token_new access_token_new)
    (access_type access_type) (management_uri management_uri)
    (management_uri_new management_uri_new) (value value) (c c) (as as)
    (rs rs))
  (defstrand client 13
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs)))
    (n1 n1) (n2 n2) (n3 n3) (n4 n4) (access access)
    (management_uri management_uri) (response response) (c c) (as as)
    (rs rs-0))
  (precedes ((0 1) (1 1)) ((0 4) (1 4)) ((1 0) (0 0)) ((1 2) (0 2))
    ((1 3) (0 3)) ((1 12) (0 5)))
  (neq (c as) (c rs) (as rs) (management_uri management_uri_new)
    (access_token access_token_new))
  (non-orig (privk rs) (privk c) (privk as))
  (uniq-orig n1 n2 n3)
  (operation encryption-test (displaced 2 0 authorization_server 5)
    (enc management_uri-0
      (enc (enc access_token value access_type (privk as)) (pubk rs))
      (hash n1 n2)) (1 4))
  (label 64)
  (parent 40)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c) (as as) (rs rs) (management_uri management_uri)
        (management_uri_new management_uri_new)
        (access_token access_token) (access_token_new access_token_new)
        (access access) (access_type access_type) (value value) (n1 n1)
        (n2 n2))))
  (origs (n2 (0 1)) (n1 (1 0)) (n3 (1 5))))</pre>

<p id="t78">Tree <a href="#top">78</a>, POV <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='454.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 454.920' font-size='12.000'>
  <text
   x='89.880' y='401.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k122&quot;, &quot;_self&quot;)'>122</text>
  <line
   x1='39.960' y1='227.460' x2='89.880' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='326.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k121&quot;, &quot;_self&quot;)'>121</text>
  <line
   x1='39.960' y1='227.460' x2='89.880' y2='339.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='251.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k120&quot;, &quot;_self&quot;)'>120</text>
  <line
   x1='39.960' y1='227.460' x2='89.880' y2='264.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='176.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k117&quot;, &quot;_self&quot;)'>117</text>
  <line
   x1='39.960' y1='227.460' x2='89.880' y2='189.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='101.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k116&quot;, &quot;_self&quot;)'>116</text>
  <line
   x1='39.960' y1='227.460' x2='89.880' y2='114.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k115&quot;, &quot;_self&quot;)'>115</text>
  <line
   x1='39.960' y1='227.460' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='213.540' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k78&quot;, &quot;_self&quot;)'>78</text>
  </svg></div>

<pre>(defprotocol token_refresh basic
  (defrole client
    (vars (c as rs name)
      (access management_uri management_uri_new response data)
      (n1 n2 n3 n4 text) (token token_new mesg))
    (trace (send (enc c n1 (pubk as))) (recv (enc as n1 n2 (pubk c)))
      (send (enc n2 (pubk as))) (send (enc c access (hash n1 n2)))
      (recv (enc management_uri token (hash n1 n2)))
      (send (enc c n3 (pubk rs))) (recv (enc rs n3 n4 (pubk c)))
      (send (enc n4 (pubk rs))) (send (enc token (hash n3 n4)))
      (recv (enc response (hash n3 n4))) (send (enc token (hash n3 n4)))
      (recv (enc response (hash n3 n4))) (send (enc token (hash n1 n2)))
      (recv (enc management_uri_new token_new (hash n1 n2)))
      (send (enc token_new (hash n3 n4)))
      (recv (enc response (hash n3 n4))))
    (uniq-orig n1 n3))
  (defrole authorization_server
    (vars (c as rs name)
      (access access_token access_token_new access_type management_uri
        management_uri_new value data) (n1 n2 text))
    (trace (recv (enc c n1 (pubk as))) (send (enc as n1 n2 (pubk c)))
      (recv (enc n2 (pubk as))) (recv (enc c access (hash n1 n2)))
      (send
        (enc management_uri
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n1 n2)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n1 n2)))
      (send
        (enc management_uri_new
          (enc (enc access_token_new value access_type (privk as))
            (pubk rs)) (hash n1 n2))))
    (uniq-orig n2))
  (defrole resource_server
    (vars (c as rs name)
      (access_token access_token_new value access_type response data)
      (n3 n4 text))
    (trace (recv (enc c n3 (pubk rs))) (send (enc rs n3 n4 (pubk c)))
      (recv (enc n4 (pubk rs)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n3 n4))) (send (enc response (hash n3 n4)))
      (recv
        (enc
          (enc (enc access_token value access_type (privk as))
            (pubk rs)) (hash n3 n4))) (send (enc response (hash n3 n4)))
      (recv
        (enc
          (enc (enc access_token_new value access_type (privk as))
            (pubk rs)) (hash n3 n4)))
      (send (enc response (hash n3 n4))))
    (uniq-orig n4)))</pre>

<p id="k78">Item <a href="#t78">78</a>, Children: <a href="#k115">115</a> <a href="#k116">116</a> <a href="#k117">117</a> <a href="#k120">120</a> <a href="#k121">121</a> <a href="#k122">122</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='754.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 754.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='714.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle style='fill: red;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle style='fill: red;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='414.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle style='fill: red;' cx='39.960' cy='339.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs))</title>
   <circle style='fill: red;' cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(enc rs n3 n4 (pubk c))</title>
   <circle cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle style='fill: blue;' cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((n3 n3) (n4 n4) (access_token access_token) (access_token_new access_token_new) (value value) (access_type access_type) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>token_refresh 78</text></svg></div>

<pre>(defskeleton token_refresh
  (vars (n3 n4 text)
    (access_token access_token_new value access_type response data)
    (c as rs name))
  (defstrand resource_server 9 (n3 n3) (n4 n4)
    (access_token access_token) (access_token_new access_token_new)
    (value value) (access_type access_type) (response response) (c c)
    (as as) (rs rs))
  (neq (c as) (c rs) (as rs) (access_token access_token_new))
  (non-orig (privk c) (privk as) (privk rs))
  (uniq-orig n4)
  (label 78)
  (unrealized (0 2) (0 3) (0 5) (0 7))
  (origs (n4 (0 1)))
  (comment &quot;2 in cohort - 2 not yet seen&quot;))</pre>

<p id="k115">Item <a href="#t78">115</a>, Parent: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='1429.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 1429.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='1314.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='1389.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 290.299 899.492 240.759 1234.025'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri_new-1 (enc (enc access_token_new value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token-1 value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri-1 (enc (enc access_token-1 value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(enc c-1 access-1 (hash n1-1 n2-1))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1-1 n2-1 (pubk c-1))</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g><title>(enc c-1 n1-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 1314.960 Q 142.920 1277.460 45.960 1314.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1314.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new-0 (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='1239.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='1164.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='1089.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='939.960' r='6.000'/></g>
  <path
   d='M 239.880 864.960 Q 142.920 827.460 45.960 864.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='864.960' r='6.000'/></g>
  <path
   d='M 239.880 789.960 Q 142.920 752.460 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle cx='239.880' cy='789.960' r='6.000'/></g>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='714.960' r='6.000'/></g>
  <path
   d='M 239.880 639.960 Q 142.920 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle cx='239.880' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri-0 (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='564.960' r='6.000'/></g>
  <g><title>(enc c-0 access-0 (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='489.960' r='6.000'/></g>
  <g><title>(enc n2-0 (pubk as-0))</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>(enc as-0 n1-0 n2-0 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g><title>(enc c-0 n1-0 (pubk as-0))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 564.960 Q 186.900 564.960 233.880 564.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri_new (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token-0 value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri (enc (enc access_token-0 value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1389.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1314.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1239.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1164.960' r='6.000'/></g>
  <path
   d='M 39.960 939.960 Q 136.920 902.460 233.880 939.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='864.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 136.920 677.460 233.880 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((n1 n1-1) (n2 n2-1) (access access-1) (access_token access_token-1) (access_token_new access_token_new) (access_type access_type) (management_uri management_uri-1) (management_uri_new management_uri_new-1) (value value) (c c-1) (as as) (rs rs-1))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs-0))) (token_new (enc (enc access_token_new value access_type (privk as)) (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4) (access access-0) (management_uri management_uri-0) (management_uri_new management_uri_new-0) (response response) (c c-0) (as as-0) (rs rs-0))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>client</text>
   </g>
  <g>
   <title>((n1 n1) (n2 n2) (access access) (access_token access_token-0) (access_token_new access_token) (access_type access_type) (management_uri management_uri) (management_uri_new management_uri_new) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((n3 n3) (n4 n4) (access_token access_token) (access_token_new access_token_new) (value value) (access_type access_type) (response response) (c c-0) (as as) (rs rs-0))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>token_refresh 115 (realized)</text>
  </svg></div>

<pre>(defskeleton token_refresh
  (vars (n3 n4 n1 n2 n1-0 n2-0 n1-1 n2-1 text)
    (access_token access_token_new value access_type response access
      access_token-0 management_uri management_uri_new access-0
      management_uri-0 management_uri_new-0 access-1 access_token-1
      management_uri-1 management_uri_new-1 data)
    (as c rs c-0 as-0 rs-0 c-1 rs-1 name))
  (defstrand resource_server 9 (n3 n3) (n4 n4)
    (access_token access_token) (access_token_new access_token_new)
    (value value) (access_type access_type) (response response) (c c-0)
    (as as) (rs rs-0))
  (defstrand authorization_server 7 (n1 n1) (n2 n2) (access access)
    (access_token access_token-0) (access_token_new access_token)
    (access_type access_type) (management_uri management_uri)
    (management_uri_new management_uri_new) (value value) (c c) (as as)
    (rs rs))
  (defstrand client 15
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs-0)))
    (token_new
      (enc (enc access_token_new value access_type (privk as))
        (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4)
    (access access-0) (management_uri management_uri-0)
    (management_uri_new management_uri_new-0) (response response)
    (c c-0) (as as-0) (rs rs-0))
  (defstrand authorization_server 7 (n1 n1-1) (n2 n2-1)
    (access access-1) (access_token access_token-1)
    (access_token_new access_token_new) (access_type access_type)
    (management_uri management_uri-1)
    (management_uri_new management_uri_new-1) (value value) (c c-1)
    (as as) (rs rs-1))
  (precedes ((0 1) (2 6)) ((0 4) (2 9)) ((1 6) (2 4)) ((2 5) (0 0))
    ((2 7) (0 2)) ((2 8) (0 3)) ((2 14) (0 7)) ((3 6) (2 13)))
  (neq (c-0 as) (c-0 rs-0) (as rs-0) (access_token access_token_new))
  (non-orig (privk as) (privk c-0) (privk rs-0))
  (uniq-orig n3 n4 n2 n1-0 n2-1)
  (operation encryption-test (added-strand authorization_server 7)
    (enc access_token_new value access_type (privk as)) (2 13))
  (label 115)
  (parent 78)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c-0) (as as) (rs rs-0) (access_token access_token)
        (access_token_new access_token_new) (value value)
        (access_type access_type) (response response) (n3 n3) (n4 n4))))
  (origs (n2-1 (3 1)) (n4 (0 1)) (n1-0 (2 0)) (n3 (2 5)) (n2 (1 1))))</pre>

<p id="k116">Item <a href="#t78">116</a>, Parent: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='1429.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 1429.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='1314.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='1389.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 1314.960 Q 142.920 1277.460 45.960 1314.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token-0 value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1314.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new-0 (enc (enc access_token-0 value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='1239.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='1164.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='1089.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='939.960' r='6.000'/></g>
  <path
   d='M 239.880 864.960 Q 142.920 827.460 45.960 864.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='864.960' r='6.000'/></g>
  <path
   d='M 239.880 789.960 Q 142.920 752.460 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle cx='239.880' cy='789.960' r='6.000'/></g>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='714.960' r='6.000'/></g>
  <path
   d='M 239.880 639.960 Q 142.920 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle cx='239.880' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri-0 (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='564.960' r='6.000'/></g>
  <g><title>(enc c-0 access-0 (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='489.960' r='6.000'/></g>
  <g><title>(enc n2-0 (pubk as-0))</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>(enc as-0 n1-0 n2-0 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g><title>(enc c-0 n1-0 (pubk as-0))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 564.960 Q 186.900 564.960 233.880 564.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri_new (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token-0 value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri (enc (enc access_token-0 value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1389.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token-0 value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1314.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1239.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1164.960' r='6.000'/></g>
  <path
   d='M 39.960 939.960 Q 136.920 902.460 233.880 939.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='864.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 136.920 677.460 233.880 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs-0))) (token_new (enc (enc access_token-0 value access_type (privk as)) (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4) (access access-0) (management_uri management_uri-0) (management_uri_new management_uri_new-0) (response response) (c c-0) (as as-0) (rs rs-0))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>client</text>
   </g>
  <g>
   <title>((n1 n1) (n2 n2) (access access) (access_token access_token-0) (access_token_new access_token) (access_type access_type) (management_uri management_uri) (management_uri_new management_uri_new) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((n3 n3) (n4 n4) (access_token access_token) (access_token_new access_token-0) (value value) (access_type access_type) (response response) (c c-0) (as as) (rs rs-0))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>token_refresh 116 (realized)</text>
  </svg></div>

<pre>(defskeleton token_refresh
  (vars (n3 n4 n1 n2 n1-0 n2-0 text)
    (access_token value access_type response access access_token-0
      management_uri management_uri_new access-0 management_uri-0
      management_uri_new-0 data) (as c rs c-0 as-0 rs-0 name))
  (defstrand resource_server 9 (n3 n3) (n4 n4)
    (access_token access_token) (access_token_new access_token-0)
    (value value) (access_type access_type) (response response) (c c-0)
    (as as) (rs rs-0))
  (defstrand authorization_server 7 (n1 n1) (n2 n2) (access access)
    (access_token access_token-0) (access_token_new access_token)
    (access_type access_type) (management_uri management_uri)
    (management_uri_new management_uri_new) (value value) (c c) (as as)
    (rs rs))
  (defstrand client 15
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs-0)))
    (token_new
      (enc (enc access_token-0 value access_type (privk as))
        (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4)
    (access access-0) (management_uri management_uri-0)
    (management_uri_new management_uri_new-0) (response response)
    (c c-0) (as as-0) (rs rs-0))
  (precedes ((0 1) (2 6)) ((0 4) (2 9)) ((1 6) (2 4)) ((2 5) (0 0))
    ((2 7) (0 2)) ((2 8) (0 3)) ((2 14) (0 7)))
  (neq (c-0 as) (c-0 rs-0) (as rs-0) (access_token access_token-0))
  (non-orig (privk as) (privk c-0) (privk rs-0))
  (uniq-orig n3 n4 n2 n1-0)
  (operation encryption-test (displaced 3 1 authorization_server 5)
    (enc access_token_new value access_type (privk as)) (2 13))
  (label 116)
  (parent 78)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c-0) (as as) (rs rs-0) (access_token access_token)
        (access_token_new access_token-0) (value value)
        (access_type access_type) (response response) (n3 n3) (n4 n4))))
  (origs (n2 (1 1)) (n4 (0 1)) (n1-0 (2 0)) (n3 (2 5))))</pre>

<p id="k117">Item <a href="#t78">117</a>, Parent: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='1429.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 1429.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='264.960' x2='239.880' y2='1314.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='639.960' x2='39.960' y2='1389.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 414.960 Q 290.221 824.482 240.602 1234.004'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri-1 (enc (enc access_token_new value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(enc c-1 access-1 (hash n1-1 n2-1))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1-1 n2-1 (pubk c-1))</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g><title>(enc c-1 n1-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 1314.960 Q 142.920 1277.460 45.960 1314.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1314.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new-0 (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='1239.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='1164.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='1089.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='939.960' r='6.000'/></g>
  <path
   d='M 239.880 864.960 Q 142.920 827.460 45.960 864.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='864.960' r='6.000'/></g>
  <path
   d='M 239.880 789.960 Q 142.920 752.460 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle cx='239.880' cy='789.960' r='6.000'/></g>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='714.960' r='6.000'/></g>
  <path
   d='M 239.880 639.960 Q 142.920 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle cx='239.880' cy='639.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri-0 (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='564.960' r='6.000'/></g>
  <g><title>(enc c-0 access-0 (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='489.960' r='6.000'/></g>
  <g><title>(enc n2-0 (pubk as-0))</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>(enc as-0 n1-0 n2-0 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g><title>(enc c-0 n1-0 (pubk as-0))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 564.960 Q 186.900 564.960 233.880 564.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri_new (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token-0 value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri (enc (enc access_token-0 value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1389.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1314.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1239.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1164.960' r='6.000'/></g>
  <path
   d='M 39.960 939.960 Q 136.920 902.460 233.880 939.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='864.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 136.920 677.460 233.880 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <g>
   <title>((n1 n1-1) (n2 n2-1) (access access-1) (access_token access_token_new) (access_type access_type) (management_uri management_uri-1) (value value) (c c-1) (as as) (rs rs-1))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs-0))) (token_new (enc (enc access_token_new value access_type (privk as)) (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4) (access access-0) (management_uri management_uri-0) (management_uri_new management_uri_new-0) (response response) (c c-0) (as as-0) (rs rs-0))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>client</text>
   </g>
  <g>
   <title>((n1 n1) (n2 n2) (access access) (access_token access_token-0) (access_token_new access_token) (access_type access_type) (management_uri management_uri) (management_uri_new management_uri_new) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((n3 n3) (n4 n4) (access_token access_token) (access_token_new access_token_new) (value value) (access_type access_type) (response response) (c c-0) (as as) (rs rs-0))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>token_refresh 117 (realized)</text>
  </svg></div>

<pre>(defskeleton token_refresh
  (vars (n3 n4 n1 n2 n1-0 n2-0 n1-1 n2-1 text)
    (access_token access_token_new value access_type response access
      access_token-0 management_uri management_uri_new access-0
      management_uri-0 management_uri_new-0 access-1 management_uri-1
      data) (as c rs c-0 as-0 rs-0 c-1 rs-1 name))
  (defstrand resource_server 9 (n3 n3) (n4 n4)
    (access_token access_token) (access_token_new access_token_new)
    (value value) (access_type access_type) (response response) (c c-0)
    (as as) (rs rs-0))
  (defstrand authorization_server 7 (n1 n1) (n2 n2) (access access)
    (access_token access_token-0) (access_token_new access_token)
    (access_type access_type) (management_uri management_uri)
    (management_uri_new management_uri_new) (value value) (c c) (as as)
    (rs rs))
  (defstrand client 15
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs-0)))
    (token_new
      (enc (enc access_token_new value access_type (privk as))
        (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4)
    (access access-0) (management_uri management_uri-0)
    (management_uri_new management_uri_new-0) (response response)
    (c c-0) (as as-0) (rs rs-0))
  (defstrand authorization_server 5 (n1 n1-1) (n2 n2-1)
    (access access-1) (access_token access_token_new)
    (access_type access_type) (management_uri management_uri-1)
    (value value) (c c-1) (as as) (rs rs-1))
  (precedes ((0 1) (2 6)) ((0 4) (2 9)) ((1 6) (2 4)) ((2 5) (0 0))
    ((2 7) (0 2)) ((2 8) (0 3)) ((2 14) (0 7)) ((3 4) (2 13)))
  (neq (c-0 as) (c-0 rs-0) (as rs-0) (access_token access_token_new))
  (non-orig (privk as) (privk c-0) (privk rs-0))
  (uniq-orig n3 n4 n2 n1-0 n2-1)
  (operation encryption-test (added-strand authorization_server 5)
    (enc access_token_new value access_type (privk as)) (2 13))
  (label 117)
  (parent 78)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c-0) (as as) (rs rs-0) (access_token access_token)
        (access_token_new access_token_new) (value value)
        (access_type access_type) (response response) (n3 n3) (n4 n4))))
  (origs (n2-1 (3 1)) (n4 (0 1)) (n1-0 (2 0)) (n3 (2 5)) (n2 (1 1))))</pre>

<p id="k120">Item <a href="#t78">120</a>, Parent: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='1279.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 1279.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='1164.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='1239.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 564.960 Q 190.461 824.513 141.042 1084.066'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri_new-0 (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='489.960' r='6.000'/></g>
  <path
   d='M 239.880 414.960 Q 192.900 414.960 145.920 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri-0 (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>(enc c-0 access-0 (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2-0 (pubk as))</title>
   <circle style='fill: blue;' cx='239.880' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1-0 n2-0 (pubk c-0))</title>
   <circle cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(enc c-0 n1-0 (pubk as))</title>
   <circle style='fill: blue;' cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 1164.960 Q 92.940 1164.960 45.960 1164.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle cx='139.920' cy='1164.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='1089.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='139.920' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle cx='139.920' cy='864.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='139.920' cy='789.960' r='6.000'/></g>
  <path
   d='M 139.920 714.960 Q 92.940 714.960 45.960 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle cx='139.920' cy='714.960' r='6.000'/></g>
  <path
   d='M 139.920 639.960 Q 92.940 639.960 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4 (pubk rs))</title>
   <circle cx='139.920' cy='639.960' r='6.000'/></g>
  <g><title>(enc rs n3 n4 (pubk c))</title>
   <circle style='fill: blue;' cx='139.920' cy='564.960' r='6.000'/></g>
  <path
   d='M 139.920 489.960 Q 92.940 489.960 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle cx='139.920' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle cx='139.920' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as-0))</title>
   <circle cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(enc as-0 n1 n2 (pubk c))</title>
   <circle style='fill: blue;' cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as-0))</title>
   <circle cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1239.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1164.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1089.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1014.960' r='6.000'/></g>
  <path
   d='M 39.960 789.960 Q 86.940 789.960 133.920 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <path
   d='M 39.960 564.960 Q 86.940 564.960 133.920 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc rs n3 n4 (pubk c))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((n1 n1-0) (n2 n2-0) (access access-0) (access_token access_token) (access_token_new access_token_new) (access_type access_type) (management_uri management_uri-0) (management_uri_new management_uri_new-0) (value value) (c c-0) (as as) (rs rs-0))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs))) (token_new (enc (enc access_token_new value access_type (privk as)) (pubk rs))) (n1 n1) (n2 n2) (n3 n3) (n4 n4) (access access) (management_uri management_uri) (management_uri_new management_uri_new) (response response) (c c) (as as-0) (rs rs))</title>
   <text
    x='139.920' y='77.460' style='text-anchor: middle;'>client</text>
   </g>
  <g>
   <title>((n3 n3) (n4 n4) (access_token access_token) (access_token_new access_token_new) (value value) (access_type access_type) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>token_refresh 120 (realized)</text>
  </svg></div>

<pre>(defskeleton token_refresh
  (vars (n3 n4 n1 n2 n1-0 n2-0 text)
    (access_token_new value access_type response access management_uri
      management_uri_new access-0 access_token management_uri-0
      management_uri_new-0 data) (as c as-0 rs c-0 rs-0 name))
  (defstrand resource_server 9 (n3 n3) (n4 n4)
    (access_token access_token) (access_token_new access_token_new)
    (value value) (access_type access_type) (response response) (c c)
    (as as) (rs rs))
  (defstrand client 15
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs)))
    (token_new
      (enc (enc access_token_new value access_type (privk as))
        (pubk rs))) (n1 n1) (n2 n2) (n3 n3) (n4 n4) (access access)
    (management_uri management_uri)
    (management_uri_new management_uri_new) (response response) (c c)
    (as as-0) (rs rs))
  (defstrand authorization_server 7 (n1 n1-0) (n2 n2-0)
    (access access-0) (access_token access_token)
    (access_token_new access_token_new) (access_type access_type)
    (management_uri management_uri-0)
    (management_uri_new management_uri_new-0) (value value) (c c-0)
    (as as) (rs rs-0))
  (precedes ((0 1) (1 6)) ((0 4) (1 9)) ((1 5) (0 0)) ((1 7) (0 2))
    ((1 8) (0 3)) ((1 14) (0 7)) ((2 4) (1 4)) ((2 6) (1 13)))
  (neq (c as) (c rs) (as rs) (access_token access_token_new))
  (non-orig (privk as) (privk c) (privk rs))
  (uniq-orig n3 n4 n1 n2-0)
  (operation encryption-test (displaced 1 3 authorization_server 7)
    (enc access_token_new value access_type (privk as)) (2 13))
  (label 120)
  (parent 78)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c) (as as) (rs rs) (access_token access_token)
        (access_token_new access_token_new) (value value)
        (access_type access_type) (response response) (n3 n3) (n4 n4))))
  (origs (n2-0 (2 1)) (n4 (0 1)) (n1 (1 0)) (n3 (1 5))))</pre>

<p id="k121">Item <a href="#t78">121</a>, Parent: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='1279.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 1279.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='564.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='1164.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='1239.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 564.960 Q 290.421 824.513 241.002 1084.066'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri_new-0 (enc (enc access_token_new value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle cx='339.840' cy='564.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token-0 value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle style='fill: blue;' cx='339.840' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri-1 (enc (enc access_token-0 value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(enc c-1 access-1 (hash n1-1 n2-1))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1-1 n2-1 (pubk c-1))</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g><title>(enc c-1 n1-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 1164.960 Q 142.920 1127.460 45.960 1164.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1164.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='1089.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='864.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='789.960' r='6.000'/></g>
  <path
   d='M 239.880 714.960 Q 142.920 677.460 45.960 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='714.960' r='6.000'/></g>
  <path
   d='M 239.880 639.960 Q 142.920 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle cx='239.880' cy='639.960' r='6.000'/></g>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='564.960' r='6.000'/></g>
  <path
   d='M 239.880 489.960 Q 142.920 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle cx='239.880' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri-0 (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>(enc c-0 access-0 (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2-0 (pubk as-0))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g><title>(enc as-0 n1-0 n2-0 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(enc c-0 n1-0 (pubk as-0))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 186.900 414.960 233.880 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1239.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1164.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1089.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1014.960' r='6.000'/></g>
  <path
   d='M 39.960 789.960 Q 136.920 752.460 233.880 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <path
   d='M 39.960 564.960 Q 136.920 527.460 233.880 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((n1 n1-1) (n2 n2-1) (access access-1) (access_token access_token-0) (access_token_new access_token_new) (access_type access_type) (management_uri management_uri-1) (management_uri_new management_uri_new-0) (value value) (c c-1) (as as) (rs rs-1))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs-0))) (token_new (enc (enc access_token_new value access_type (privk as)) (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4) (access access-0) (management_uri management_uri-0) (management_uri_new management_uri_new) (response response) (c c-0) (as as-0) (rs rs-0))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>client</text>
   </g>
  <g>
   <title>((n1 n1) (n2 n2) (access access) (access_token access_token) (access_type access_type) (management_uri management_uri) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((n3 n3) (n4 n4) (access_token access_token) (access_token_new access_token_new) (value value) (access_type access_type) (response response) (c c-0) (as as) (rs rs-0))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>token_refresh 121 (realized)</text>
  </svg></div>

<pre>(defskeleton token_refresh
  (vars (n3 n4 n1 n2 n1-0 n2-0 n1-1 n2-1 text)
    (access_token access_token_new value access_type response access
      management_uri access-0 management_uri-0 management_uri_new
      access-1 access_token-0 management_uri-1 management_uri_new-0
      data) (as c rs c-0 as-0 rs-0 c-1 rs-1 name))
  (defstrand resource_server 9 (n3 n3) (n4 n4)
    (access_token access_token) (access_token_new access_token_new)
    (value value) (access_type access_type) (response response) (c c-0)
    (as as) (rs rs-0))
  (defstrand authorization_server 5 (n1 n1) (n2 n2) (access access)
    (access_token access_token) (access_type access_type)
    (management_uri management_uri) (value value) (c c) (as as) (rs rs))
  (defstrand client 15
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs-0)))
    (token_new
      (enc (enc access_token_new value access_type (privk as))
        (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4)
    (access access-0) (management_uri management_uri-0)
    (management_uri_new management_uri_new) (response response) (c c-0)
    (as as-0) (rs rs-0))
  (defstrand authorization_server 7 (n1 n1-1) (n2 n2-1)
    (access access-1) (access_token access_token-0)
    (access_token_new access_token_new) (access_type access_type)
    (management_uri management_uri-1)
    (management_uri_new management_uri_new-0) (value value) (c c-1)
    (as as) (rs rs-1))
  (precedes ((0 1) (2 6)) ((0 4) (2 9)) ((1 4) (2 4)) ((2 5) (0 0))
    ((2 7) (0 2)) ((2 8) (0 3)) ((2 14) (0 7)) ((3 6) (2 13)))
  (neq (c-0 as) (c-0 rs-0) (as rs-0) (access_token access_token_new))
  (non-orig (privk as) (privk c-0) (privk rs-0))
  (uniq-orig n3 n4 n2 n1-0 n2-1)
  (operation encryption-test (added-strand authorization_server 7)
    (enc access_token_new value access_type (privk as)) (2 13))
  (label 121)
  (parent 78)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c-0) (as as) (rs rs-0) (access_token access_token)
        (access_token_new access_token_new) (value value)
        (access_type access_type) (response response) (n3 n3) (n4 n4))))
  (origs (n2-1 (3 1)) (n4 (0 1)) (n1-0 (2 0)) (n3 (2 5)) (n2 (1 1))))</pre>

<p id="k122">Item <a href="#t78">122</a>, Parent: <a href="#k78">78</a>.</p>

<div>
 <svg
  class='diagram' width='379.800pt' height='1279.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 379.800 1279.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='339.840' y1='114.960' x2='339.840' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='239.880' y1='114.960' x2='239.880' y2='1164.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='489.960' x2='39.960' y2='1239.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 339.840 414.960 Q 290.299 749.492 240.759 1084.025'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri-1 (enc (enc access_token_new value access_type (privk as)) (pubk rs-1)) (hash n1-1 n2-1))</title>
   <circle cx='339.840' cy='414.960' r='6.000'/></g>
  <g><title>(enc c-1 access-1 (hash n1-1 n2-1))</title>
   <circle style='fill: blue;' cx='339.840' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1-1 n2-1 (pubk c-1))</title>
   <circle cx='339.840' cy='189.960' r='6.000'/></g>
  <g><title>(enc c-1 n1-1 (pubk as))</title>
   <circle style='fill: blue;' cx='339.840' cy='114.960' r='6.000'/></g>
  <path
   d='M 239.880 1164.960 Q 142.920 1127.460 45.960 1164.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='1164.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri_new (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='1089.960' r='6.000'/>
   </g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='1014.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='939.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='864.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: blue;' cx='239.880' cy='789.960' r='6.000'/></g>
  <path
   d='M 239.880 714.960 Q 142.920 677.460 45.960 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle cx='239.880' cy='714.960' r='6.000'/></g>
  <path
   d='M 239.880 639.960 Q 142.920 602.460 45.960 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle cx='239.880' cy='639.960' r='6.000'/></g>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='564.960' r='6.000'/></g>
  <path
   d='M 239.880 489.960 Q 142.920 452.460 45.960 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle cx='239.880' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc management_uri-0 (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n1-0 n2-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='414.960' r='6.000'/></g>
  <g><title>(enc c-0 access-0 (hash n1-0 n2-0))</title>
   <circle cx='239.880' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2-0 (pubk as-0))</title>
   <circle cx='239.880' cy='264.960' r='6.000'/></g>
  <g><title>(enc as-0 n1-0 n2-0 (pubk c-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='189.960' r='6.000'/></g>
  <g><title>(enc c-0 n1-0 (pubk as-0))</title>
   <circle cx='239.880' cy='114.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 186.900 414.960 233.880 414.960'
   style='stroke-dasharray: 6.000,2.400; stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc management_uri (enc (enc access_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1239.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token_new value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1164.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='1089.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='1014.960' r='6.000'/></g>
  <path
   d='M 39.960 789.960 Q 136.920 752.460 233.880 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle cx='39.960' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc access_token value access_type (privk as)) (pubk rs-0)) (hash n3 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='639.960' r='6.000'/></g>
  <path
   d='M 39.960 564.960 Q 136.920 527.460 233.880 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc rs-0 n3 n4 (pubk c-0))</title>
   <circle cx='39.960' cy='564.960' r='6.000'/></g>
  <g><title>(enc c-0 n3 (pubk rs-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>((n1 n1-1) (n2 n2-1) (access access-1) (access_token access_token_new) (access_type access_type) (management_uri management_uri-1) (value value) (c c-1) (as as) (rs rs-1))</title>
   <text
    x='339.840' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((token (enc (enc access_token value access_type (privk as)) (pubk rs-0))) (token_new (enc (enc access_token_new value access_type (privk as)) (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4) (access access-0) (management_uri management_uri-0) (management_uri_new management_uri_new) (response response) (c c-0) (as as-0) (rs rs-0))</title>
   <text
    x='239.880' y='77.460' style='text-anchor: middle;'>client</text>
   </g>
  <g>
   <title>((n1 n1) (n2 n2) (access access) (access_token access_token) (access_type access_type) (management_uri management_uri) (value value) (c c) (as as) (rs rs))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((n3 n3) (n4 n4) (access_token access_token) (access_token_new access_token_new) (value value) (access_type access_type) (response response) (c c-0) (as as) (rs rs-0))</title>
   <text
    x='39.960' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <text
   x='189.900' y='39.960'
   style='text-anchor: middle;'>token_refresh 122 (realized)</text>
  </svg></div>

<pre>(defskeleton token_refresh
  (vars (n3 n4 n1 n2 n1-0 n2-0 n1-1 n2-1 text)
    (access_token access_token_new value access_type response access
      management_uri access-0 management_uri-0 management_uri_new
      access-1 management_uri-1 data)
    (as c rs c-0 as-0 rs-0 c-1 rs-1 name))
  (defstrand resource_server 9 (n3 n3) (n4 n4)
    (access_token access_token) (access_token_new access_token_new)
    (value value) (access_type access_type) (response response) (c c-0)
    (as as) (rs rs-0))
  (defstrand authorization_server 5 (n1 n1) (n2 n2) (access access)
    (access_token access_token) (access_type access_type)
    (management_uri management_uri) (value value) (c c) (as as) (rs rs))
  (defstrand client 15
    (token
      (enc (enc access_token value access_type (privk as)) (pubk rs-0)))
    (token_new
      (enc (enc access_token_new value access_type (privk as))
        (pubk rs-0))) (n1 n1-0) (n2 n2-0) (n3 n3) (n4 n4)
    (access access-0) (management_uri management_uri-0)
    (management_uri_new management_uri_new) (response response) (c c-0)
    (as as-0) (rs rs-0))
  (defstrand authorization_server 5 (n1 n1-1) (n2 n2-1)
    (access access-1) (access_token access_token_new)
    (access_type access_type) (management_uri management_uri-1)
    (value value) (c c-1) (as as) (rs rs-1))
  (precedes ((0 1) (2 6)) ((0 4) (2 9)) ((1 4) (2 4)) ((2 5) (0 0))
    ((2 7) (0 2)) ((2 8) (0 3)) ((2 14) (0 7)) ((3 4) (2 13)))
  (neq (c-0 as) (c-0 rs-0) (as rs-0) (access_token access_token_new))
  (non-orig (privk as) (privk c-0) (privk rs-0))
  (uniq-orig n3 n4 n2 n1-0 n2-1)
  (operation encryption-test (added-strand authorization_server 5)
    (enc access_token_new value access_type (privk as)) (2 13))
  (label 122)
  (parent 78)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c-0) (as as) (rs rs-0) (access_token access_token)
        (access_token_new access_token_new) (value value)
        (access_type access_type) (response response) (n3 n3) (n4 n4))))
  (origs (n2-1 (3 1)) (n4 (0 1)) (n1-0 (2 0)) (n3 (2 5)) (n2 (1 1))))</pre>

</body>
</html>
