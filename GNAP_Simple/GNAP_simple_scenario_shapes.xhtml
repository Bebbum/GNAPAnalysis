<?xml version="1.0"?>
<!-- CPSA 3.6.9 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Grant Negotiation and Authorization Protocol</title>
 <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
 <style>
  svg.diagram { border-width: 1px; border-style: solid }
 </style>
</head>
<body>

<pre>(comment &quot;CPSA 3.6.9&quot;)
(comment &quot;Extracted shapes&quot;)
(herald &quot;Grant Negotiation and Authorization Protocol&quot; (limit 2000)
  (comment
    &quot;This protocol allows a piece of software, the client instance, to request delegated authorization to resource servers and to request direct information&quot;))
(comment &quot;CPSA 3.6.9&quot;)
(comment &quot;All input read from GNAP_simple_scenario.scm&quot;)</pre>

<p id="t0">Tree 0, POV <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='129.840pt' height='79.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 129.840 79.920' font-size='12.000'>
  <text
   x='89.880' y='26.040'
   style='font-weight: bold; text-anchor: middle; fill: blue;'
   onclick='window.open(&quot;#k563&quot;, &quot;_self&quot;)'>563</text>
  <line
   x1='39.960' y1='39.960' x2='89.880' y2='39.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <text
   x='39.960' y='26.040' style='text-anchor: middle; fill: black;'
   onclick='window.open(&quot;#k0&quot;, &quot;_self&quot;)'>0</text>
  </svg></div>

<pre>(defprotocol single_token_simple basic
  (defrole client
    (vars (c as rs name)
      (access acess_token value access_type response data)
      (n1 n2 n3 n4 text))
    (trace (send (enc c n1 (pubk as))) (recv (enc as n1 n2 (pubk c)))
      (send (enc n2 (pubk as))) (send (enc c access (hash n1 n2)))
      (recv
        (enc
          (enc (enc acess_token value access_type (privk as)) (pubk rs))
          (hash n1 n2))) (send (enc c n3 (pubk rs)))
      (recv (enc as n3 n4 (pubk c))) (send (enc n3 (pubk rs)))
      (send
        (enc
          (enc (enc acess_token value access_type (privk as)) (pubk rs))
          (hash n3 n4))) (recv (enc response (hash n3 n4)))))
  (defrole authorization_server
    (vars (c as rs name) (access acess_token value access_type data)
      (n1 n2 text))
    (trace (recv (enc c n1 (pubk as))) (send (enc as n1 n2 (pubk c)))
      (recv (enc n2 (pubk as))) (recv (enc c access (hash n1 n2)))
      (send
        (enc
          (enc (enc acess_token value access_type (privk as)) (pubk rs))
          (hash n1 n2)))))
  (defrole resource_server
    (vars (c as rs name) (acess_token value access_type response data)
      (n3 n4 text))
    (trace (recv (enc c n3 (pubk rs))) (send (enc as n3 n4 (pubk c)))
      (recv (enc n3 (pubk rs)))
      (recv
        (enc
          (enc (enc acess_token value access_type (privk as)) (pubk rs))
          (hash n3 n4))) (send (enc response (hash n3 n4))))))</pre>

<p id="k0">Item <a href="#t0">0</a>, Child: <a href="#k563">563</a>.</p>

<div>
 <svg
  class='diagram' width='79.920pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 79.920 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <g><title>(enc response (hash n3 n4))</title>
   <circle style='fill: red;' cx='39.960' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc acess_token value access_type (privk as)) (pubk rs)) (hash n3 n4))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <g><title>(enc n3 (pubk rs))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(enc as n3 n4 (pubk c))</title>
   <circle style='fill: red;' cx='39.960' cy='564.960' r='6.000'/></g>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc acess_token value access_type (privk as)) (pubk rs)) (hash n1 n2))</title>
   <circle style='fill: red;' cx='39.960' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n2))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g><title>(enc n2 (pubk as))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n2 (pubk c))</title>
   <circle style='fill: red;' cx='39.960' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((n1 n1) (n2 n2) (n3 n3) (n4 n4) (access access) (acess_token acess_token) (value value) (access_type access_type) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>client</text></g>
  <text
   x='39.960' y='39.960'
   style='text-anchor: middle;'>single_token_simple 0</text></svg></div>

<pre>(defskeleton single_token_simple
  (vars (n1 n3 n2 n4 text)
    (access acess_token value access_type response data) (c as rs name))
  (defstrand client 10 (n1 n1) (n2 n2) (n3 n3) (n4 n4) (access access)
    (acess_token acess_token) (value value) (access_type access_type)
    (response response) (c c) (as as) (rs rs))
  (neq (c as) (c rs) (as rs))
  (non-orig (privk c) (privk as) (privk rs))
  (uniq-orig n1 n3)
  (label 0)
  (unrealized (0 1) (0 4) (0 6) (0 9))
  (origs (n1 (0 0)) (n3 (0 5)))
  (comment &quot;1 in cohort - 1 not yet seen&quot;))</pre>

<p id="k563">Item <a href="#t0">563</a>, Parent: <a href="#k0">0</a>.</p>

<div>
 <svg
  class='diagram' width='279.840pt' height='829.920pt'
  xmlns='http://www.w3.org/2000/svg' version='1.1'
  viewBox='0 0 279.840 829.920' font-size='12.000'>
  <defs>
   <marker
    id='arrow' orient='auto' markerWidth='5' markerHeight='10' refX='5'
    refY='5'>
    <path
     d='M 0 0 5 5 0 10'
     style='stroke-width: 2; fill: none; stroke: black;'/></marker>
   </defs>
  <line
   x1='239.880' y1='489.960' x2='239.880' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='139.920' y1='114.960' x2='139.920' y2='414.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <line
   x1='39.960' y1='114.960' x2='39.960' y2='789.960'
   style='stroke-width: 0.960; stroke: gray;'/>
  <path
   d='M 239.880 789.960 Q 142.920 752.460 45.960 789.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc response (hash n3 n4-0))</title>
   <circle cx='239.880' cy='789.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc acess_token value access_type (privk as)) (pubk rs)) (hash n3 n4-0))</title>
   <circle style='fill: blue;' cx='239.880' cy='714.960' r='6.000'/></g>
  <g><title>(enc n3 (pubk rs))</title>
   <circle style='fill: blue;' cx='239.880' cy='639.960' r='6.000'/></g>
  <path
   d='M 239.880 564.960 Q 142.920 527.460 45.960 564.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc as n3 n4-0 (pubk c))</title>
   <circle cx='239.880' cy='564.960' r='6.000'/></g>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle style='fill: blue;' cx='239.880' cy='489.960' r='6.000'/></g>
  <path
   d='M 139.920 414.960 Q 92.940 414.960 45.960 414.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc acess_token value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle cx='139.920' cy='414.960' r='6.000'/></g>
  <g><title>(enc c access (hash n1 n4))</title>
   <circle style='fill: blue;' cx='139.920' cy='339.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='264.960' r='6.000'/></g>
  <path
   d='M 139.920 189.960 Q 92.940 189.960 45.960 189.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc as n1 n4 (pubk c))</title>
   <circle cx='139.920' cy='189.960' r='6.000'/></g>
  <g><title>(enc c n1 (pubk as))</title>
   <circle style='fill: blue;' cx='139.920' cy='114.960' r='6.000'/></g>
  <g><title>(enc response (hash n3 n4-0))</title>
   <circle style='fill: blue;' cx='39.960' cy='789.960' r='6.000'/></g>
  <path
   d='M 39.960 714.960 Q 136.920 677.460 233.880 714.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g>
   <title>(enc (enc (enc acess_token value access_type (privk as)) (pubk rs)) (hash n3 n4-0))</title>
   <circle cx='39.960' cy='714.960' r='6.000'/></g>
  <path
   d='M 39.960 639.960 Q 136.920 602.460 233.880 639.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc n3 (pubk rs))</title>
   <circle cx='39.960' cy='639.960' r='6.000'/></g>
  <g><title>(enc as n3 n4-0 (pubk c))</title>
   <circle style='fill: blue;' cx='39.960' cy='564.960' r='6.000'/></g>
  <path
   d='M 39.960 489.960 Q 136.920 452.460 233.880 489.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c n3 (pubk rs))</title>
   <circle cx='39.960' cy='489.960' r='6.000'/></g>
  <g>
   <title>(enc (enc (enc acess_token value access_type (privk as)) (pubk rs)) (hash n1 n4))</title>
   <circle style='fill: blue;' cx='39.960' cy='414.960' r='6.000'/></g>
  <path
   d='M 39.960 339.960 Q 86.940 339.960 133.920 339.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c access (hash n1 n4))</title>
   <circle cx='39.960' cy='339.960' r='6.000'/></g>
  <g><title>(enc n4 (pubk as))</title>
   <circle cx='39.960' cy='264.960' r='6.000'/></g>
  <g><title>(enc as n1 n4 (pubk c))</title>
   <circle style='fill: blue;' cx='39.960' cy='189.960' r='6.000'/></g>
  <path
   d='M 39.960 114.960 Q 86.940 114.960 133.920 114.960'
   style='stroke-width: 0.960; stroke: black; marker-end: url(#arrow); fill: none;'/>
  <g><title>(enc c n1 (pubk as))</title>
   <circle cx='39.960' cy='114.960' r='6.000'/></g>
  <g>
   <title>((n3 n3) (n4 n4-0) (acess_token acess_token) (value value) (access_type access_type) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='239.880' y='77.460'
    style='text-anchor: middle;'>resource_server</text></g>
  <g>
   <title>((n1 n1) (n2 n4) (access access) (acess_token acess_token) (value value) (access_type access_type) (c c) (as as) (rs rs))</title>
   <text
    x='139.920' y='77.460'
    style='text-anchor: middle;'>authorization_server</text></g>
  <g>
   <title>((n1 n1) (n2 n4) (n3 n3) (n4 n4-0) (access access) (acess_token acess_token) (value value) (access_type access_type) (response response) (c c) (as as) (rs rs))</title>
   <text
    x='39.960' y='77.460' style='text-anchor: middle;'>client</text></g>
  <text
   x='139.920' y='39.960'
   style='text-anchor: middle;'>single_token_simple 563 (realized)</text>
  </svg></div>

<pre>(defskeleton single_token_simple
  (vars (n1 n3 n4 n4-0 text)
    (access acess_token value access_type response data) (c as rs name))
  (defstrand client 10 (n1 n1) (n2 n4) (n3 n3) (n4 n4-0) (access access)
    (acess_token acess_token) (value value) (access_type access_type)
    (response response) (c c) (as as) (rs rs))
  (defstrand authorization_server 5 (n1 n1) (n2 n4) (access access)
    (acess_token acess_token) (value value) (access_type access_type)
    (c c) (as as) (rs rs))
  (defstrand resource_server 5 (n3 n3) (n4 n4-0)
    (acess_token acess_token) (value value) (access_type access_type)
    (response response) (c c) (as as) (rs rs))
  (precedes ((0 0) (1 0)) ((0 3) (1 3)) ((0 5) (2 0)) ((0 7) (2 2))
    ((0 8) (2 3)) ((1 1) (0 1)) ((1 4) (0 4)) ((2 1) (0 6))
    ((2 4) (0 9)))
  (neq (c as) (c rs) (as rs))
  (non-orig (privk c) (privk as) (privk rs))
  (uniq-orig n1 n3)
  (operation encryption-test (displaced 3 0 client 9)
    (enc
      (enc (enc acess_token-0 value-0 access_type-0 (privk as))
        (pubk rs)) (hash n3 n4-0)) (2 3))
  (label 563)
  (parent 0)
  (unrealized)
  (shape)
  (maps
    ((0)
      ((c c) (as as) (rs rs) (n1 n1) (n3 n3) (access access)
        (acess_token acess_token) (value value)
        (access_type access_type) (response response) (n2 n4)
        (n4 n4-0))))
  (origs (n1 (0 0)) (n3 (0 5))))</pre>

</body>
</html>
